---
layout: default
---

<div id="home-app">
    <!-- Filters / Loading State -->
    <div class="filters" style="margin-bottom: 20px; text-align: center;">
        <select id="topic-filter" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="">All Topics</option>
            <!-- JS will populate -->
        </select>
    </div>

    <div id="loading-indicator" style="text-align: center; padding: 20px;">
        Loading articles...
    </div>

    <!-- Article List Container -->
    <div id="article-list" class="posts-list" style="display: none;">
        <!-- JS will populate this -->
    </div>
</div>

<script>
    const API_URL = "{{ site.view_api_url }}"; // Use Jekyll config var
    
    document.addEventListener("DOMContentLoaded", async () => {
        const listContainer = document.getElementById("article-list");
        const loading = document.getElementById("loading-indicator");
        const topicFilter = document.getElementById("topic-filter");
        
        // Initial Load
        const isEn = window.location.pathname.includes("/en/");
        const lang = isEn ? "en" : "vi";

        // Parallel Fetch: Articles & Topics
        try {
            const [postsRes, topicsRes] = await Promise.all([
                fetch(`${API_URL}/api/articles?lang=${lang}`),
                fetch(`${API_URL}/api/topics`)
            ]);

            const posts = await postsRes.json();
            const topics = await topicsRes.json();

            // Render Topics
            topics.forEach(t => {
                const opt = document.createElement("option");
                opt.value = t.name; // Simple filter by name or ID
                opt.textContent = t.name;
                topicFilter.appendChild(opt);
            });

            // Filter Logic
            topicFilter.addEventListener("change", () => {
                const selected = topicFilter.value;
                const filtered = selected 
                    ? posts.filter(p => p.topic_name === selected)
                    : posts;
                renderPosts(filtered);
            });

            loading.style.display = "none";
            listContainer.style.display = "block";
            renderPosts(posts);

        } catch (e) {
            loading.innerText = "Error loading content. Please try again later.";
            console.error(e);
        }
        
        function renderPosts(data) {
            if (data.length === 0) {
                listContainer.innerHTML = "<p>No articles found.</p>";
                return;
            }

            listContainer.innerHTML = data.map(post => `
                <article class="post-preview">
                    <a href="/view?slug=${post.slug}">
                        <h2 class="post-title">${post.title}</h2>
                        ${post.excerpt ? `<h3 class="post-subtitle">${post.excerpt}</h3>` : ''}
                    </a>
                    <p class="post-meta">
                        Posted by Author on ${new Date(post.created_at * 1000).toLocaleDateString()}
                        ${post.topic_name ? ` Â· <span class="topic-tag">${post.topic_name}</span>` : ''}
                    </p>
                </article>
                <hr>
            `).join("");
        }
    });
</script>
