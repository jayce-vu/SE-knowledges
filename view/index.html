<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>
      SE-knowledges
    </title>
    <link rel="icon" type="image/svg+xml" href="/SE-knowledges/assets/favicon.svg">
    <link rel="stylesheet" href="/SE-knowledges/assets/css/style.css" />
  </head>
  <body>
    <header class="site">
  <div class="wrap nav">
    <div class="brand">
      <a class="title" href="/SE-knowledges/">SE-knowledges</a>
      <span class="subtitle">Technical notes and articles in Vietnamese and English.</span>
    </div>
    <div>
      
      
      
      

      

      
        <a class="button" href="/SE-knowledges/en/">English</a>
        <a class="button" href="/SE-knowledges/vi/">Tiếng Việt</a>
      
      
      <!-- Auth Button (Hidden by default, JS toggles) -->
      <a class="button" id="auth-btn" href="/SE-knowledges/login.html" style="margin-left: 10px; border: 1px solid #ddd;">Login</a>
    </div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("token");
      const authBtn = document.getElementById("auth-btn");
      if (token) {
        authBtn.textContent = "Admin";
        authBtn.href = "/SE-knowledges/admin.html";
      }
    });
  </script>
</header>

    <main class="wrap">
      <div id="article-app">
    <div id="loading" style="text-align: center; padding: 50px;">
        Loading article...
    </div>

    <article id="article-content" style="display: none;">
        <header class="intro-header" id="header-bg" style="background-image: url('/SE-knowledges/assets/img/home-bg.jpg')">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="post-heading">
                            <h1 id="post-title">Title</h1>
                            <h2 class="subheading" id="post-excerpt"></h2>
                            <span class="meta">Posted by <span id="post-author">Author</span> on <span id="post-date">Date</span></span>
                            
                            <!-- Language Switcher -->
                            <div class="lang-switcher" style="margin-top: 20px;">
                                <button id="btn-vi" class="btn btn-default btn-xs">Tiếng Việt</button>
                                <button id="btn-en" class="btn btn-default btn-xs">English</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div id="markdown-body">
                        <!-- Content -->
                    </div>

                    <hr>
                    <!-- Comments Section -->
                    <div class="comments-section">
                        <h3>Comments</h3>
                        <div id="comments-list"></div>
                        <form id="comment-form" style="margin-top: 20px;">
                            <div class="form-group">
                                <textarea id="comment-content" class="form-control" placeholder="Write a comment..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </article>
</div>

<!-- Marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
    const API_URL = "https://se-knowledges.jayce-it-work.workers.dev";
    let currentSlug = new URLSearchParams(window.location.search).get("slug");

    document.addEventListener("DOMContentLoaded", async () => {
        if (!currentSlug) {
            window.location.href = "/";
            return;
        }
        loadArticle(currentSlug);

        // Comment Form
        document.getElementById("comment-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const content = document.getElementById("comment-content").value;
            // Mock guest user
            const payload = {
                post_slug: currentSlug,
                content: content,
                guest_name: "Guest",
                guest_email: "guest@example.com"
            };
            
            await fetch(`${API_URL}/api/comments`, {
                method: "POST",
                body: JSON.stringify(payload)
            });
            alert("Comment submitted!");
            loadComments(currentSlug); // Reload
            document.getElementById("comment-content").value = "";
        });
    });

    async function loadArticle(slug) {
        try {
            const res = await fetch(`${API_URL}/api/articles/${slug}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("loading").innerText = "Article not found.";
                return;
            }

            // Render Meta
            document.getElementById("post-title").innerText = data.title;
            document.getElementById("post-excerpt").innerText = data.excerpt || "";
            document.getElementById("post-author").innerText = data.author_name || "Unknown";
            document.getElementById("post-date").innerText = new Date(data.created_at * 1000).toLocaleDateString();
            
            if (data.thumbnail_url) {
                document.getElementById("header-bg").style.backgroundImage = `url('${data.thumbnail_url}')`;
            }

            // Render Content
            document.getElementById("markdown-body").innerHTML = marked.parse(data.content || "");

            // Show
            document.getElementById("loading").style.display = "none";
            document.getElementById("article-content").style.display = "block";

            // Load Comments
            loadComments(slug);

        } catch (e) {
            console.error(e);
            document.getElementById("loading").innerText = "Error loading article.";
        }
    }

    async function loadComments(slug) {
        const res = await fetch(`${API_URL}/api/comments?post_slug=${slug}`);
        const comments = await res.json();
        const list = document.getElementById("comments-list");
        list.innerHTML = comments.map(c => `
            <div class="media">
                <div class="media-body">
                    <h5 class="media-heading">${c.guest_name || c.username} <small>${new Date(c.created_at * 1000).toLocaleDateString()}</small></h5>
                    ${c.content}
                </div>
            </div>
        `).join("");
    }
</script>

    </main>
    <footer class="site">
  <div class="wrap">
    <div class="panel">
      <div>
        <span class="pill">EN/VI</span>
        <span class="pill">GitHub Pages</span>
        <span class="pill">Jekyll</span>
      </div>
      <div style="margin-top: 10px;">
        © 2026 SE-knowledges. Built with Jekyll on GitHub Pages.
      </div>
    </div>
  </div>
</footer>


  </body>
</html>

